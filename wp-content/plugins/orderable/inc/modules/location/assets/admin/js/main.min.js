(t=>{let i={on_ready(){i.cache(),i.add_listeners()},cache(){i.post_id=t("#post_ID").val(),t("#orderable_multi_location_store_services_meta_box").length?i.$metabox=t("#orderable_multi_location_store_services_meta_box"):i.$metabox=t("#orderable_location_store_services_meta_box"),i.$modal_wrapper=t("#orderable-delivery-zones-modal-wrapper"),i.$modal_add_update=t("#orderable-delivery-zones-modal-add-update"),i.$modal_add_existing=t("#orderable-delivery-zones-modal-add-existing"),i.msg_timeout=null,i.modal_transition_time_slot_id=null,i.add_existing_modal_opened=!1},add_listeners(){i.$modal_wrapper.on("click",".js-delivery-zones-tab-nav-link",i.handler_toggle_tabs),i.$modal_wrapper.on("click","#js-cancel-delivery-zone-modal",i.handler_close_modal),i.$modal_wrapper.on("click","#js-add-new-delivery-zone",i.handler_add_update_zone),i.$modal_wrapper.on("click","#js-add-existing-delivery-zone",i.handler_add_existing_zone),i.$modal_wrapper.on("click","#js-transition-existing-to-new-modal",i.handler_transition_modal),i.$modal_wrapper.on("change",".js-delivery-zones-list-item input",i.handler_mark_zone_selected),i.$modal_wrapper.on("keyup","#js-delivery-zone-search",i.handler_zone_search),i.$modal_wrapper.on("change keyup",i.handler_modal_form_change),i.$metabox.on("click",".js-open-add-delivery-zone-modal",i.handler_open_add_update_modal),i.$metabox.on("click",".js-add-existing-delivery-zone",i.handler_open_add_existing_modal),i.$metabox.on("click",".js-remove-delivery-zone",i.handler_remove_zone),t(document.body).on("orderable-remove-row",i.handler_remove_all_time_slot_zones),t(document).on("keyup","#js-delivery-zone-modal-fee",i.handler_sanitize_fee),t(document).on("keyup",i.handler_escape_key_close_modal),t(document).on("orderable-delivery-zone-ajax-success",i.handler_trigger_dom_update),t(document).on("orderable-delivery-zone-after-dom-update",i.handler_after_dom_update)},handler_trigger_dom_update(e,{request_data:a,response_data:o}){if(a.request_type)switch(a.request_type){case"edit":i.update_delivery_zone_in_time_slot(a,o);break;case"add_new":case"add_existing":i.insert_delivery_zone_in_time_slot(a,o);break;case"remove":i.remove_delivery_zone_in_time_slot(a,o);break;case"delete":i.remove_delivery_zone_in_list_table(a,o)}},handler_after_dom_update(e,o){setTimeout(function(){var e,a;"add_new"===o.request.request_type&&(e=wp.template("existing-zones-list-item"),a=i.generate_zone_row_data(o.request,o.response,o.time_slot_row),t("#js-delivery-zone-modal-zones-list").append(e(a))),i.close_modal()},250)},handler_toggle_tabs(e){},handler_escape_key_close_modal(e){"Escape"==e.key&&i.handler_close_modal()},handler_open_add_update_modal(e,a){let o;var d="add-new"===(o=a||(t(e.target).hasClass("dashicons")?t(e.target).parent():t(e.target)).data("action"))?window.orderable_dz_js_vars.text.modal_add:window.orderable_dz_js_vars.text.modal_update,a=a?i.modal_transition_time_slot_id:i.get_time_slot_id(e),r=i.get_time_slot_index(e);i.$modal_add_update.find(".orderable-delivery-zones-modal__title").text(d),i.$modal_add_update.find(".orderable-delivery-zones-modal__button--add-update .text").text(d),i.$modal_add_update.find(".js-delivery-zone-modal-time-slot").val(a),i.$modal_add_update.find(".js-delivery-zone-modal-time-slot-index").val(r),"edit"===o&&i.form_add_zone_data(e),setTimeout(function(){t("body").css({"overflow-y":"hidden"}),i.$modal_wrapper.show(),i.$modal_add_update.fadeIn()},250)},handler_open_add_existing_modal(e){var a=i.get_time_slot_id(e),o=i.get_time_slot_index(e);i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot").val(a),i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot-index").val(o),i.hide_existing_time_slot_zones(e),setTimeout(function(){t("body").css({"overflow-y":"hidden"}),i.$modal_wrapper.show(),i.$modal_add_existing.fadeIn(),i.maybe_show_no_zones_msg()},100)},handler_close_modal(e){i.close_modal(e)},handler_add_update_zone(e){i.maybe_show_modal_spinner();var a=t("#js-delivery-zone-modal-zone-id").val(),o={request_type:a?"edit":"add_new",post_id:i.post_id,time_slot_index:parseInt(i.$modal_add_update.find(".js-delivery-zone-modal-time-slot-index").val()),time_slot_id:parseInt(i.$modal_add_update.find(".js-delivery-zone-modal-time-slot").val()),zone_name:t("#js-delivery-zone-modal-area-name").val(),zone_postcodes:t("#js-delivery-zone-modal-postcodes").val(),zone_fee:t("#js-delivery-zone-modal-fee").val()};a&&(o.zone_id=a),o.zone_name&&o.zone_postcodes?i.handler_trigger_dom_update(e,{request_data:o,response_data:{data:{status:!0,zone_id:a||Date.now()}}}):(o.zone_name||t("#js-delivery-zone-modal-valid-name").fadeIn(),o.zone_postcodes||t("#js-delivery-zone-modal-valid-postcodes").fadeIn(),i.maybe_show_modal_spinner())},handler_add_existing_zone(o){i.maybe_show_modal_spinner(),t(".orderable-delivery-zones-modal__field-checkbox:checked").each(function(e,a){a={request_type:"add_existing",post_id:i.post_id,zone_id:t(a).val(),time_slot_index:i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot-index").val(),time_slot_id:i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot").val(),zone_name:t(a).data("zone-name"),zone_postcodes:t(a).data("zone-postcodes"),zone_fee:t(a).data("zone-fee")};i.handler_trigger_dom_update(o,{request_data:a,response_data:{data:{status:!0,zone_id:a.zone_id}}})}),i.close_modal()},handler_transition_modal(e){i.modal_transition_time_slot_id=t(e.target).closest(".orderable-delivery-zones-modal__form").find(".js-delivery-zone-modal-time-slot").val(),i.close_modal(e,!0)},handler_remove_zone(e){var a,o;window.confirm(window.orderable_dz_js_vars.text.zone_confirm_remove)&&(a=i.get_time_slot_id(e),o=i.get_zone_id(e),i.handler_trigger_dom_update(e,{request_data:{request_type:"remove",zone_id:o,time_slot_id:a},response_data:{data:{status:!0,zone_ids:[o]}}}))},handler_remove_all_time_slot_zones(e,a){let o=t(a.trigger_element).closest(".orderable-table__row"),d=o.data("orderable-time-slot"),r=o.find(".orderable-table-delivery-zones-row__item"),l=[];r.each(function(e,a){l.push(t(a).data("zone-id"))}),i.handler_trigger_dom_update(e,{request_data:{request_type:"remove",zone_ids:l,time_slot_id:d},response_data:{data:{status:!0,zone_ids:l,msg:"All delivery zones successfully removed!"}}})},handler_sanitize_fee(e){t(e.target).val(t(e.target).val().replace(/[^0-9.]/gm,""))},handler_zone_search(e){let a=t(".orderable-delivery-zones-modal-add-existing .orderable-delivery-zones-modal__zones-list-item:not(.hide-existing)"),r=t(e.target).val().toLowerCase();a.length?(clearTimeout(void 0),setTimeout(function(){!r||r.length<2?a.show():a.each(function(e,a){var o=t(a),d=o.find("input[type=checkbox]").data("zone-name").toLowerCase();o.hasClass("hide-existing")||!d.includes(r)?t(a).hide():t(a).show()}),i.maybe_show_no_zones_msg()},100)):i.maybe_show_no_zones_msg()},handler_modal_form_change(e){var a=t("#js-add-new-delivery-zone"),o=t("#js-add-existing-delivery-zone");t("#js-delivery-zone-modal-postcodes").val()&&t("#js-delivery-zone-modal-area-name").val()?a.prop("disabled",!1):a.prop("disabled",!0),t(".orderable-delivery-zones-modal__zones-list-item.selected").length?o.prop("disabled",!1):o.prop("disabled",!0)},handler_mark_zone_selected(e){e=t(e.target).closest(".orderable-delivery-zones-modal__zones-list-item");e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")},maybe_show_no_zones_msg(){var e=t(".orderable-delivery-zones-modal-add-existing .orderable-delivery-zones-modal__zones-list-item:not(.hide-existing):visible"),a=t("#js-no-delivery-zones-msg"),o=t(".orderable-delivery-zones-modal__button--add-existing");e.length?(i.add_existing_modal_opened&&(o.prop("disabled",!1),i.add_existing_modal_opened=!0),a.hide()):(o.prop("disabled",!0),a.show())},generate_zone_row_data(e,a,o=!1){let d=null;a=e.zone_id||a.data.zone_id,o.length&&(d="edit"===e.request_type?o.find(`.orderable-table-delivery-zones-row__item[data-zone-id=${a}]`).data("zone-count"):o.find(".orderable-table-delivery-zones-row__item").length+1),o={time_slot_id:e.time_slot_id,zone_id:a,zone_name:e.zone_name,zone_postcodes:e.zone_postcodes,zone_fee:e.zone_fee};return{...o,input_value:JSON.stringify(o),delivery_zone_id:d,time_slot_index:e.time_slot_index,text_zone_title:window.orderable_dz_js_vars.text.zone_title,text_edit_zone:window.orderable_dz_js_vars.text.zone_edit,text_remove_zone:window.orderable_dz_js_vars.text.zone_remove}},insert_delivery_zone_in_time_slot(e,a){var o=t(`.orderable-toggle-wrapper--delivery [data-orderable-index=${e.time_slot_index}]`),d=wp.template("delivery-zones-row"),r=i.generate_zone_row_data(e,a,o),d=(o.find(".orderable-table-delivery-zones-row__no-items").hide(),o.find(".orderable-table-delivery-zones-row__actions").before(d(r)),a.data.status?"success":"error");t(document).trigger("orderable-delivery-zone-after-dom-update",{status:d,request:e,response:a,time_slot_row:o})},update_delivery_zone_in_time_slot(e,a){var o,d,r,l;e.time_slot_id&&(o=t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${e.time_slot_id}]`),d=wp.template("delivery-zones-row"),r=i.generate_zone_row_data(e,a,o),l=e.zone_id||a.data.zone_id,o.find(`.orderable-table-delivery-zones-row__item[data-zone-id=${l}]`).replaceWith(d(r)),t(document).trigger("orderable-delivery-zone-after-dom-update",{status:"success",request:e,response:a}))},remove_delivery_zone_in_time_slot(e,a){for(var o of a.data.zone_ids)t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${e.time_slot_id}] .orderable-table-delivery-zones-row__item[data-zone-id=${o}]`).remove();var d=t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${e.time_slot_id}]`);d.find(".orderable-table-delivery-zones-row__item").length||d.find(".orderable-table-delivery-zones-row__no-items").fadeIn(),t(document).trigger("orderable-delivery-zone-after-dom-update",{status:a.success,request:e,response:a}),i.reset_modal_forms()},form_add_zone_data(e){e=t(e.target).closest("[data-zone-id]");t("#js-delivery-zone-modal-zone-id").val(e.attr("data-zone-id")),t("#js-delivery-zone-modal-postcodes").val(e.attr("data-zone-postcodes")),t("#js-delivery-zone-modal-area-name").val(e.attr("data-zone-name")),t("#js-delivery-zone-modal-fee").val(e.attr("data-zone-fee")),t("#js-delivery-zone-modal-postcodes").val()&&t("#js-delivery-zone-modal-area-name").val()&&t("#js-add-new-delivery-zone").prop("disabled",!1)},close_modal(e,a=!1){setTimeout(function(){t("body").css({"overflow-y":"visible"}),a||i.$modal_wrapper.fadeOut(),i.$modal_wrapper.find(".orderable-delivery-zones-modal").hide(),t(".orderable-delivery-zones-modal__msg").fadeOut(),i.maybe_show_modal_spinner(!0),i.unhide_existing_time_slot_zones(),i.reset_modal_forms(),i.add_existing_modal_opened=!1,t(".orderable-delivery-zones-modal__footer .orderable-delivery-zones-modal__button--add-update").prop("disabled",!0),t(".orderable-delivery-zones-modal__footer .orderable-delivery-zones-modal__button--add-existing").prop("disabled",!0),a&&i.handler_open_add_update_modal(e,"add-new")},250)},reset_modal_forms(){i.$modal_wrapper.find('input:not([type="checkbox"]), textarea').val(""),i.$modal_wrapper.find('input[type="checkbox"]').removeAttr("checked"),i.$modal_wrapper.find(".orderable-delivery-zones-modal__zones-list-item").removeClass("selected").fadeIn()},maybe_show_modal_spinner(e=!1){var a=t(".orderable-delivery-zones-modal__button .icon");e||a.hasClass("active")?a.removeClass("active"):a.addClass("active")},hide_existing_time_slot_zones(e){let a=i.get_time_slot_id(e),d=t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${a}]`),o=t(".orderable-delivery-zones-modal__zones-list-item");d.length&&o.each(function(e,a){var o=t(a).find("input").val();o&&d.find(`.orderable-table-delivery-zones-row__item[data-zone-id="${o}"]`).length&&t(a).addClass("hide-existing")})},unhide_existing_time_slot_zones(){t(".orderable-delivery-zones-modal__zones-list-item").removeClass("hide-existing")},get_time_slot_id(e){return parseInt(t(e.target).closest(".orderable-table__row").data("orderable-time-slot"))},get_time_slot_index(e){return parseInt(t(e.target).closest(".orderable-table__row").data("orderable-index"))},get_zone_id(e){return t(e.target).closest(".orderable-table-delivery-zones-row__item").data("zone-id")}};t(document).ready(i.on_ready)})(jQuery),(o=>{var a={on_ready(){o(".orderable-toggle-field").on("click",a.handle_toggle_field_on_click),o(".orderable-override-open-hours-toggle-field").on("click",a.handle_override_open_hours_on_click),o(".orderable-delivery-toggle-field").on("click",a.handle_enable_service_delivery_on_click),o(".orderable-pickup-toggle-field").on("click",a.handle_enable_service_pickup_on_click),o(".orderable-admin-button--pickup").on("click",function(){o("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked")?o(".orderable-element--pickup").addClass("orderable-element--disabled"):o(".orderable-element--pickup").removeClass("orderable-element--disabled")});var e=o(".datepicker").data("datepicker");o(".datepicker").datepicker(e),o(document.body).on("orderable-new-row",a.on_new_holiday_row)},handle_toggle_field_on_click(){o(this).toggleClass(["woocommerce-input-toggle--disabled","woocommerce-input-toggle--enabled"]);var e=o(this).hasClass("woocommerce-input-toggle--enabled");o(this).siblings(".orderable-toggle-field__input").val(e?"yes":"no")},handle_override_open_hours_on_click(){o(this).siblings(".orderable-open-hours-settings").toggleClass("orderable-store-open-hours--hide"),o(".orderable-store-open-hours__open-hours").toggleClass("orderable-store-open-hours--hide")},handle_enable_service_delivery_on_click(){var e=o(this).hasClass("woocommerce-input-toggle--enabled");pickup_is_enabled="yes"===o("[name=orderable_location_store_services_pickup]").val(),e?(o(".orderable-admin-button--delivery").removeClass("orderable-ui-hide"),o(".orderable-notice--select-service").addClass("orderable-ui-hide")):o(".orderable-admin-button--delivery").addClass("orderable-ui-hide").removeClass("orderable-trigger-element--active"),pickup_is_enabled&&e?(o("#orderable_location_service_hours_pickup_same_as_delivery_label").removeClass("orderable-ui-hide"),o(".orderable-toggle-wrapper--pickup").find(".orderable-select--days").first().val().length||o("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!0).change()):e&&!pickup_is_enabled?(o("#orderable_location_service_hours_pickup_same_as_delivery_label").removeClass("orderable-ui-hide"),o(".orderable-admin-button--delivery").addClass("orderable-trigger-element--active"),o(".orderable-toggle-wrapper--delivery").addClass("orderable-toggle-wrapper--active")):e||pickup_is_enabled?!e&&pickup_is_enabled&&(o("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!1).change(),o("#orderable_location_service_hours_pickup_same_as_delivery_label").addClass("orderable-ui-hide"),o(".orderable-table--service-hours-pickup").removeClass("orderable-element--disabled"),o(".orderable-admin-button--pickup").addClass("orderable-trigger-element--active"),o(".orderable-toggle-wrapper--pickup").addClass("orderable-toggle-wrapper--active").removeClass("orderable-element--disabled"),o(".orderable-admin-button--delivery").removeClass("orderable-trigger-element--active"),o(".orderable-toggle-wrapper--delivery").removeClass("orderable-toggle-wrapper--active")):(o(".orderable-notice--select-service").removeClass("orderable-ui-hide"),o(".orderable-toggle-wrapper--delivery").removeClass("orderable-toggle-wrapper--active"))},handle_enable_service_pickup_on_click(){var e=o(this).hasClass("woocommerce-input-toggle--enabled"),a="yes"===o("[name=orderable_location_store_services_delivery]").val();e?(o(".orderable-admin-button--pickup").removeClass("orderable-ui-hide"),o(".orderable-table--service-hours-pickup").removeClass("orderable-element--disabled"),o(".orderable-notice--select-service").addClass("orderable-ui-hide")):o(".orderable-admin-button--pickup").addClass("orderable-ui-hide").removeClass("orderable-trigger-element--active"),e&&a?(o("#orderable_location_service_hours_pickup_same_as_delivery_label").removeClass("orderable-ui-hide"),o("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!0).change()):e&&!a?(o("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!1).change(),o("#orderable_location_service_hours_pickup_same_as_delivery_label").addClass("orderable-ui-hide"),o(".orderable-admin-button--pickup").addClass("orderable-trigger-element--active"),o(".orderable-toggle-wrapper--pickup").addClass("orderable-toggle-wrapper--active").removeClass("orderable-element--disabled"),o(".orderable-element--pickup").removeClass("orderable-element--disabled")):!e&&a?(o("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!0).change(),o("#orderable_location_service_hours_pickup_same_as_delivery_label").addClass("orderable-ui-hide"),o(".orderable-table--service-hours-delivery").removeClass("orderable-element--disabled"),o(".orderable-admin-button--delivery").addClass("orderable-trigger-element--active"),o(".orderable-toggle-wrapper--delivery").addClass("orderable-toggle-wrapper--active").removeClass("orderable-element--disabled"),o(".orderable-admin-button--pickup").removeClass("orderable-trigger-element--active"),o(".orderable-toggle-wrapper--pickup").removeClass("orderable-toggle-wrapper--active")):a||e||(o(".orderable-notice--select-service").removeClass("orderable-ui-hide"),o(".orderable-toggle-wrapper--pickup").removeClass("orderable-toggle-wrapper--active"))},on_new_holiday_row(){o(".orderable-table--holidays").find(".orderable-table__row--repeatable:last-child").find(".datepicker").each(function(){var e=o(this).data("datepicker");o(this).datepicker(e)})}};o(document).ready(a.on_ready)})(jQuery);