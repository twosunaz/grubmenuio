var OrderableMultilocationPostcodeField={init(){jQuery(document).ready(function(){"1"===orderable_multi_location_params.is_multi_location_mode&&(jQuery("#ship-to-different-address-checkbox").is(":checked")?OrderableMultilocationPostcodeField.prepareField("shipping"):OrderableMultilocationPostcodeField.prepareField("billing"),OrderableMultilocationPostcodeField.handleChangeOfDestination(),jQuery(document).on("click",".opml-postcode-btn",function(){jQuery(document.body).trigger("opml_open_popup")}))})},prepareField(o){var e,t;jQuery(`#${o}_postcode_field`).append(`<span class='opml-postcode-btn'>
			<span class='opml-postcode-btn__icon'></span>
			<span class='opml-postcode-btn__edit'>${orderable_multi_location_params.i18n.edit}</span>
			</span>`),jQuery(`#${o}_postcode`).attr("readonly",!0),jQuery(`#${o}_postcode`).is(":visible")&&(e=jQuery(`#${o}_postcode_field`).offset(),t=jQuery(`#${o}_postcode`).offset(),jQuery(".opml-postcode-btn").css({top:t.top-e.top,height:jQuery(`#${o}_postcode`).outerHeight()}))},unprepareField(o){jQuery(`#${o}_postcode_field `).find(".opml-postcode-btn").remove(),jQuery(`#${o}_postcode`).attr("readonly",!1)},handleChangeOfDestination(){jQuery("#ship-to-different-address-checkbox").change(function(){jQuery(this).is(":checked")?(OrderableMultilocationPostcodeField.unprepareField("billing"),setTimeout(function(){OrderableMultilocationPostcodeField.prepareField("shipping")},100)):(OrderableMultilocationPostcodeField.unprepareField("shipping"),OrderableMultilocationPostcodeField.prepareField("billing"))})}},OrderableMultilocationGeolocate=(OrderableMultilocationPostcodeField.init(),{init(){jQuery(document).on("click",".opml-store-locator__geolocate",this.handleClick)},handleClick(){($btn=jQuery(".opml-store-locator__geolocate-btn")).addClass("opml-store-locator__geolocate-btn--loading"),navigator.geolocation?navigator.geolocation.getCurrentPosition(OrderableMultilocationGeolocate.onLocationDetected,OrderableMultilocationGeolocate.handleGeolocateError):$btn.removeClass("opml-store-locator__geolocate-btn--loading")},onLocationDetected(o){$btn=jQuery(".opml-store-locator__geolocate-btn");o={lat:o.coords.latitude,long:o.coords.longitude,action:"opml_get_postcode_from_coords"};jQuery.post(orderable_vars.ajax_url,o).done(function(o){o&&o.success&&o.data&&o.data.postcode&&(jQuery(".opml-store-locator-input__input").val(o.data.postcode).trigger("change"),OrderableMultiLocation.search(jQuery(".opml-store-locator-input__input")))}).fail(function(){OrderableMultilocationGeolocate.handleGeolocateError()}).always(function(){$btn.removeClass("opml-store-locator__geolocate-btn--loading")})},handleGeolocateError(){jQuery(".opml-store-locator__geolocate").addClass("opml-store-locator__geolocate--error").html(`<p>${orderable_multi_location_params.i18n.geolocate_error}</p>`)}}),OrderableMultilocationInput=(OrderableMultilocationGeolocate.init(),{init(){jQuery(document).ready(()=>OrderableMultilocationInput.toggleActiveClass()),jQuery(document).on("change blur",".opml-store-locator-input__input",function(){OrderableMultilocationInput.toggleActiveClass()}),jQuery(document).on("focus",".opml-store-locator-input__input",function(){jQuery(this).closest(".opml-store-locator-input").addClass("opml-is-active")}),jQuery(document).on("click",".opml-store-locator-input__label",function(){jQuery(this).closest(".opml-store-locator-input").find(".opml-store-locator-input__input").focus()})},toggleActiveClass(o){(o=o||jQuery(".opml-store-locator-input__input")).each(function(){var o=jQuery(this).closest(".opml-store-locator-input");jQuery(this).val()?o.addClass("opml-is-active"):o.removeClass("opml-is-active")})}}),OrderableMultiLocation=(OrderableMultilocationInput.init(),{mouseDownCordinates:!1,init(){let e=this.debounce(this.search,1e3);jQuery(document).on("keyup",".opml-store-locator .opml-store-locator-input__input",o=>{e(jQuery(o.target))}),jQuery(document).on("click","[opml-store-popup-open]",this.openPopup),jQuery(document).on("click",".opml-mini-locator[data-type=notset]",this.openPopup),jQuery(document.body).on("opml_open_popup",this.openPopup),jQuery(document.body).on("opml_close_popup",this.closePopup),jQuery(document).on("click","[opml-store-popup-close]",this.closePopup),document.addEventListener("keydown",this.closePopupOnEscKey),jQuery(document).on("mousedown",".opml-popup--closable",this.handleMouseDown),jQuery(document).on("mouseup",".opml-popup--closable",this.handleMouseUp),jQuery(document).on("click",".opml-select-store-button",this.saveLocation),jQuery(document).ready(function(){jQuery(".opml-popup--openonload").length&&OrderableMultiLocation.openPopup()}),document.addEventListener("scroll",this.handleScroll,!0)},openPopup(o){o&&o.preventDefault&&o.preventDefault();var o=jQuery(".opml-popup .opml-store-locator-input__input"),e=jQuery("#shipping_postcode"),t=jQuery("#billing_postcode"),l=jQuery("#ship-to-different-address-checkbox").is(":checked");let r="";!(r=e.length&&l?e.val().trim():r)&&t.length&&(r=t.val().trim()),OrderableMultiLocation.isCheckoutPage()&&r&&o.val(r),jQuery(".opml-popup").addClass("opml-popup--open"),OrderableMultilocationInput.toggleActiveClass(),o.val().trim()&&OrderableMultiLocation.search(o)},closePopup(){jQuery(".opml-popup").not(".opml-popup--loading").removeClass("opml-popup--open")},handleMouseDown(o){OrderableMultiLocation.mouseDownCordinates=o.originalEvent},handleMouseUp(o){var e=jQuery(".opml-popup__content")[0].getBoundingClientRect();e&&OrderableMultiLocation.mouseDownCordinates&&OrderableMultiLocation.mouseDownCordinates.clientX>e.x&&OrderableMultiLocation.mouseDownCordinates.clientX<e.x+e.width||(this.mouseDownCordinates=!1,o.target===this&&OrderableMultiLocation.closePopup())},search(o){let e=o.closest(".opml-store-locator-input"),t=e.closest(".opml-store-locator"),l=t.find(".opml-store-locator__results"),r=jQuery("#ship-to-different-address-checkbox").is(":checked");jQuery(".opml-store-locator__geolocate").hide(),e.addClass("opml-is-loading");o={action:"opml_search_location_by_postcode",postcode:o.val(),order_date:jQuery(".orderable-order-timings__date").val(),state:(r?jQuery("#shipping_state"):jQuery("#billing_state")).val(),city:(r?jQuery("#shipping_city"):jQuery("#billing_city")).val(),_wpnonce_orderable:jQuery("#_wpnonce_orderable").val()};jQuery.post(orderable_vars.ajax_url,o,function(o){o.success?l.html(o.data.html).slideDown("fast",function(){OrderableMultiLocation.handleScroll({},1)}):(o&&o.data&&o.data.message?l.html(`<div class='opml-store-locator-notice'>${o.data.message}</div>`):(l.slideUp("fast",function(){OrderableMultiLocation.handleScroll({},1)}),jQuery(".opml-store-locator__geolocate"))).slideDown(),e.removeClass("opml-is-loading")})},saveLocation(o){o.preventDefault();let t=jQuery(this),l=t.closest(".opml-popup");o=t.closest(".opml-search-single-store");if(!t.hasClass("opml-select-store-button--disabled")){l.addClass("opml-popup--loading"),t.addClass("opml-is-loading");let e=o.data("location-id");o={action:"opml_save_location",_nonce:orderable_multi_location_params.location_nonce,postcode:l.find(".opml-store-locator-input__input").val(),type:t.data("type"),location_id:e};jQuery.post(orderable_vars.ajax_url,o,function(o){o.success?(jQuery(".opml-select-store-button").removeClass("opml-select-store-button--selected"),t.addClass("opml-select-store-button--selected"),t.data("eta")&&jQuery(".orderable-order-timings__date").val(t.data("eta")).trigger("change"),OrderableMultiLocation.isCheckoutPage()&&o&&o.data&&o.data.updated_shipping_method&&(parseInt(jQuery('[name="opml_selected_location"]').val())!==e&&(jQuery('[type="radio"][name="shipping_method[0]"]').prop("checked",!1),jQuery('[type="hidden"][name="shipping_method[0]"]').remove()),jQuery('[name="shipping_method[0]"]').each(function(){jQuery(this).prop("checked",o.data.updated_shipping_method===jQuery(this).val())})),OrderableMultiLocation.updatePostcode(l.find(".opml-store-locator-input__input").val()),jQuery(document.body).trigger("update_checkout"),l.removeClass("opml-popup--loading"),t.removeClass("opml-is-loading"),OrderableMultiLocation.closePopup()):alert("Something went wrong")})}},handleScroll(o,e){(e||o.target&&o.target.classList&&o.target.classList.contains("opml-store-results"))&&($result=jQuery(".opml-store-results")).length&&($result.scrollTop()+$result.innerHeight()>=$result[0].scrollHeight-20?jQuery(".opml-store-locator__results").removeClass("has-scroll-bottom"):jQuery(".opml-store-locator__results").addClass("has-scroll-bottom"))},debounce(l,r,a){let i;return function(){let o=this,e=arguments;var t=a&&!i;clearTimeout(i),i=setTimeout(function(){i=null,a||l.apply(o,e)},r),t&&l.apply(o,e)}},closePopupOnEscKey(o){"Escape"!==o.key&&"Esc"!==o.key&&27!==o.keyCode||jQuery(".opml-popup--closable").length&&OrderableMultiLocation.closePopup()},isCheckoutPage(){return jQuery("body").hasClass("woocommerce-checkout")},updatePostcode(o){(jQuery("#ship-to-different-address-checkbox").is(":checked")&&jQuery("#shipping_postcode").length?jQuery("#shipping_postcode"):jQuery("#billing_postcode")).val(o)}}),OrderableMultiLocationPostcode=(OrderableMultiLocation.init(),{init(){jQuery(document).on("click",".opml-postcode-locator__button",OrderableMultiLocationPostcode.handle_button_click)},handle_button_click(){var o=jQuery(this).closest(".opml-postcode-locator");o.length&&(o=o.find(".opml-store-locator-input__input"),jQuery(".opml-store-locator-input__input").val(o.val().trim()),jQuery(document.body).trigger("opml_open_popup"))}});OrderableMultiLocationPostcode.init();