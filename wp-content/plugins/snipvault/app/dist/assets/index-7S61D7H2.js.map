{"version":3,"file":"index-7S61D7H2.js","sources":["../../src/components/app/file-browser-editor/src/constants.js","../../src/components/app/file-browser-editor/index.vue"],"sourcesContent":["import { ref } from \"vue\";\n\nexport const snippet = ref(null);\nexport const codeeditor = ref(null);\n","<script setup>\nimport { ref, watchEffect, watch, onMounted, nextTick } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { getSnippets } from \"@/components/app/snippets-list/src/getSnippets.js\";\n\n// Components\nimport CodeEditor from \"@/components/app/code-editor/index.vue\";\nimport AppSelect from \"@/components/utility/select/index.vue\";\nimport AppButton from \"@/components/utility/app-button/index.vue\";\nimport AppIcon from \"@/components/utility/icons/index.vue\";\nimport AppInput from \"@/components/utility/text-input/index.vue\";\nimport AppTextArea from \"@/components/utility/text-area/index.vue\";\nimport AppToggle from \"@/components/utility/toggle/index.vue\";\n\n// Store\nimport { useAppStore } from \"@/store/app/app.js\";\nconst appStore = useAppStore();\n\n// Functions\nimport { lmnFetch } from \"@/assets/js/functions/lmnFetch.js\";\nimport { notify } from \"@/assets/js/functions/notify.js\";\nimport { loadDirectory } from \"@/components/app/file-browser/src/loadDirectory.js\";\nimport { currentPath } from \"@/components/app/file-browser/src/constants.js\";\n\n// Refs\nimport { unsavedChanges } from \"@/setup/constants.js\";\nimport { snippet, codeeditor } from \"./src/constants.js\";\nconst showSettings = ref(true);\nconst saving = ref(false);\nconst ready = ref(false);\nconst showRevisions = ref(false);\nconst revisionsComp = ref(null);\nconst currentFile = ref(null);\nconst originalFile = ref(null);\nconst route = useRoute();\nconst router = useRouter();\nconst languageOptions = [\n  { value: \"PHP\", label: \"PHP\" },\n  { value: \"JAVASCRIPT\", label: \"Javascript\" },\n  { value: \"CSS\", label: \"CSS\" },\n];\n\nconst getFileContents = async () => {\n  appStore.updateState(\"loading\", true);\n  ready.value = false;\n\n  const args = {\n    endpoint: `snipvault/v1/filesystem/read/`,\n    type: \"GET\",\n    params: { path: route.params.filepath },\n  };\n  const response = await lmnFetch(args);\n\n  appStore.updateState(\"loading\", false);\n\n  if (!response) return;\n\n  currentFile.value = response.data;\n  originalFile.value = JSON.parse(JSON.stringify(response.data));\n\n  route.meta.name = currentFile.value.filename;\n\n  nextTick(() => {\n    ready.value = true;\n  });\n};\n\nconst saveFile = async () => {\n  appStore.updateState(\"loading\", true);\n  saving.value = true;\n\n  const args = {\n    endpoint: `snipvault/v1/filesystem/write/`,\n    type: \"POST\",\n    params: {},\n    data: {\n      content: currentFile.value.content,\n      path: route.params.filepath,\n      filename: currentFile.value.filename,\n    },\n  };\n  const response = await lmnFetch(args);\n\n  appStore.updateState(\"loading\", false);\n  saving.value = false;\n\n  if (!response) return;\n\n  unsavedChanges.value = false;\n\n  currentFile.value.path = response.data.path;\n  notify({ title: __(\"File saved\"), type: \"success\" });\n  loadDirectory(currentPath.value, true);\n  router.push(`/file-browser/${response.data.path}`);\n};\n\nconst downloadSnippet = () => {\n  const content = currentFile.value.content;\n  const filename = currentFile.value.filename;\n\n  // Create a blob with the content\n  const blob = new Blob([content], { type: \"text/plain\" });\n\n  // Create a URL for the blob\n  const url = URL.createObjectURL(blob);\n\n  // Create a temporary anchor element\n  const link = document.createElement(\"a\");\n  link.href = url;\n  link.download = filename;\n\n  // Append to the document, click it, and then remove it\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n\n  // Clean up the URL object\n  URL.revokeObjectURL(url);\n};\n\n// Format size\nconst formatSize = (bytes) => {\n  if (bytes === 0) return \"0 Bytes\";\n\n  const k = 1024;\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n};\n\n// Format date\nconst formatDate = (dateString) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n};\n\nwatchEffect(() => {\n  if (route.params.filepath) getFileContents();\n});\n\nwatch(\n  () => currentFile.value,\n  (newVal, oldVal) => {\n    if (ready.value && newVal.content != originalFile.value.content) {\n      unsavedChanges.value = true;\n    }\n  },\n  { deep: true }\n);\n</script>\n\n<template>\n  <div class=\"flex flex-col w-full h-full\" v-if=\"currentFile\" :key=\"currentFile?.path\">\n    <div class=\"border-b border-zinc-200 dark:border-zinc-700 px-6 py-3 flex flex-row gap-3\">\n      <div class=\"grow flex flex-col\">\n        <input v-model=\"currentFile.filename\" class=\"bg-white dark:bg-zinc-900 focus:outline-0\" style=\"field-sizing: content\" />\n        <div class=\"font-mono text-xs text-zinc-500 dark:text-zinc-400\">{{ currentFile.path }}</div>\n      </div>\n\n      <!-- status Option -->\n      <div class=\"flex flex-row items-center gap-3\">\n        <AppButton @click=\"() => codeeditor.formatDocument()\" type=\"default\" class=\"text-sm\">{{ __(\"Format\", \"snipvault\") }}</AppButton>\n        <AppButton @click=\"downloadSnippet\" type=\"default\" class=\"text-sm\" icon=\"download\">{{ __(\"Download\", \"snipvault\") }}</AppButton>\n        <AppButton @click=\"saveFile\" type=\"primary\" class=\"text-sm\" :loading=\"saving\">{{ __(\"Save\", \"snipvault\") }}</AppButton>\n      </div>\n    </div>\n\n    <div class=\"grow flex flex-row max-w-full overflow-hidden\">\n      <CodeEditor ref=\"codeeditor\" v-model=\"currentFile.content\" :language=\"currentFile.language.toUpperCase()\" :ensurePHP=\"false\" class=\"grow shrink overflow-hidden\" />\n\n      <div class=\"border-l border-zinc-200 dark:border-zinc-700 w-[340px] shrink-0\">\n        <div class=\"col-span-3 flex flex-row place-content-between items-center p-6 border-b border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100\">\n          <div class=\"\" v-html=\"currentFile.filename\"></div>\n        </div>\n\n        <div class=\"p-6 grid grid-cols-3 gap-3\">\n          <!-- Name -->\n          <div class=\"flex flex-col justify-center\">\n            <span class=\"text-sm text-zinc-500 dark:text-zinc-400\">{{ __(\"Name\", \"snipvault\") }}</span>\n          </div>\n          <AppInput type=\"text\" class=\"col-span-2\" v-model=\"currentFile.filename\" />\n\n          <!-- Path -->\n          <div class=\"flex flex-col justify-center\">\n            <span class=\"text-sm text-zinc-500 dark:text-zinc-400\">{{ __(\"Path\", \"snipvault\") }}</span>\n          </div>\n          <AppInput type=\"text\" class=\"col-span-2\" :disabled=\"true\" v-model=\"currentFile.path\" :copy=\"true\" />\n\n          <!-- Language -->\n          <div class=\"flex flex-col justify-center\">\n            <span class=\"text-sm text-zinc-500 dark:text-zinc-400\">{{ __(\"Language\", \"snipvault\") }}</span>\n          </div>\n          <div class=\"col-span-2\">{{ currentFile.language }}</div>\n\n          <!-- Modified -->\n          <div class=\"flex flex-col justify-center\">\n            <span class=\"text-sm text-zinc-500 dark:text-zinc-400\">{{ __(\"Modified\", \"snipvault\") }}</span>\n          </div>\n          <div class=\"col-span-2\">{{ formatDate(currentFile.modified) }}</div>\n\n          <!-- Size -->\n          <div class=\"flex flex-col justify-center\">\n            <span class=\"text-sm text-zinc-500 dark:text-zinc-400\">{{ __(\"Size\", \"snipvault\") }}</span>\n          </div>\n          <div class=\"col-span-2\">{{ formatSize(currentFile.size) }}</div>\n\n          <div class=\"col-span-3 rounded-lg bg-rose-500/10 border border-rose-600/60 p-4 text-sm mt-6\" v-if=\"currentFile.is_core_file\">\n            {{ __(\"This is likely a WordPress core file. Changes made here will probably be lost during WordPress updates. Use hooks or custom plugins instead.\", \"snipvault\") }}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n"],"names":["ref","codeeditor","appStore","useAppStore","saving","ready","currentFile","originalFile","route","useRoute","router","useRouter","getFileContents","args","response","lmnFetch","nextTick","saveFile","unsavedChanges","notify","loadDirectory","currentPath","downloadSnippet","content","filename","blob","url","link","formatSize","bytes","k","sizes","i","formatDate","dateString","date","watchEffect","watch","newVal","oldVal"],"mappings":"6aAEuBA,EAAI,IAAI,EACxB,MAAMC,EAAaD,EAAI,IAAI,quCCalC,MAAME,EAAWC,EAAY,EAWRH,EAAI,EAAI,EACvB,MAAAI,EAASJ,EAAI,EAAK,EAClBK,EAAQL,EAAI,EAAK,EACDA,EAAI,EAAK,EACTA,EAAI,IAAI,EACxB,MAAAM,EAAcN,EAAI,IAAI,EACtBO,EAAeP,EAAI,IAAI,EACvBQ,EAAQC,EAAS,EACjBC,EAASC,EAAU,EAOnBC,EAAkB,SAAY,CACzBV,EAAA,YAAY,UAAW,EAAI,EACpCG,EAAM,MAAQ,GAEd,MAAMQ,EAAO,CACX,SAAU,gCACV,KAAM,MACN,OAAQ,CAAE,KAAML,EAAM,OAAO,QAAS,CACxC,EACMM,EAAW,MAAMC,EAASF,CAAI,EAE3BX,EAAA,YAAY,UAAW,EAAK,EAEhCY,IAELR,EAAY,MAAQQ,EAAS,KAC7BP,EAAa,MAAQ,KAAK,MAAM,KAAK,UAAUO,EAAS,IAAI,CAAC,EAEvDN,EAAA,KAAK,KAAOF,EAAY,MAAM,SAEpCU,EAAS,IAAM,CACbX,EAAM,MAAQ,EAAA,CACf,EACH,EAEMY,EAAW,SAAY,CAClBf,EAAA,YAAY,UAAW,EAAI,EACpCE,EAAO,MAAQ,GAEf,MAAMS,EAAO,CACX,SAAU,iCACV,KAAM,OACN,OAAQ,CAAC,EACT,KAAM,CACJ,QAASP,EAAY,MAAM,QAC3B,KAAME,EAAM,OAAO,SACnB,SAAUF,EAAY,MAAM,QAAA,CAEhC,EACMQ,EAAW,MAAMC,EAASF,CAAI,EAE3BX,EAAA,YAAY,UAAW,EAAK,EACrCE,EAAO,MAAQ,GAEVU,IAELI,EAAe,MAAQ,GAEXZ,EAAA,MAAM,KAAOQ,EAAS,KAAK,KACvCK,EAAO,CAAE,SAAO,OAAA,GAAA,KAAA,IAAG,YAAY,EAAG,KAAM,UAAW,EACrCC,EAAAC,EAAY,MAAO,EAAI,EACrCX,EAAO,KAAK,iBAAiBI,EAAS,KAAK,IAAI,EAAE,EACnD,EAEMQ,EAAkB,IAAM,CACtB,MAAAC,EAAUjB,EAAY,MAAM,QAC5BkB,EAAWlB,EAAY,MAAM,SAG7BmB,EAAO,IAAI,KAAK,CAACF,CAAO,EAAG,CAAE,KAAM,aAAc,EAGjDG,EAAM,IAAI,gBAAgBD,CAAI,EAG9BE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWH,EAGP,SAAA,KAAK,YAAYG,CAAI,EAC9BA,EAAK,MAAM,EACF,SAAA,KAAK,YAAYA,CAAI,EAG9B,IAAI,gBAAgBD,CAAG,CACzB,EAGME,EAAcC,GAAU,CACxB,GAAAA,IAAU,EAAU,MAAA,UAExB,MAAMC,EAAI,KACJC,EAAQ,CAAC,QAAS,KAAM,KAAM,IAAI,EAClCC,EAAI,KAAK,MAAM,KAAK,IAAIH,CAAK,EAAI,KAAK,IAAIC,CAAC,CAAC,EAElD,OAAO,YAAYD,EAAQ,KAAK,IAAIC,EAAGE,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAI,IAAMD,EAAMC,CAAC,CACxE,EAGMC,EAAcC,GAAe,CAC3B,MAAAC,EAAO,IAAI,KAAKD,CAAU,EAChC,OAAOC,EAAK,mBAAA,EAAuB,IAAMA,EAAK,mBAAmB,CACnE,EAEA,OAAAC,EAAY,IAAM,CACZ5B,EAAM,OAAO,UAA0BI,EAAA,CAAA,CAC5C,EAEDyB,EACE,IAAM/B,EAAY,MAClB,CAACgC,EAAQC,IAAW,CACdlC,EAAM,OAASiC,EAAO,SAAW/B,EAAa,MAAM,UACtDW,EAAe,MAAQ,GAE3B,EACA,CAAE,KAAM,EAAK,CACf"}