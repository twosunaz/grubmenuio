import{u as ee,a as te,c as se,e as d,f as K,O as pe,q as de,r as ae,g as v,o as c,j as a,i as n,A as fe,_ as f,B as ve,p as L,C as _e,w as r,k as m,D as F,t as i,F as E,v as J,x as A,n as B,l as V,M as Q,s as O,E as we}from"../app.build.DVcfFWU_.js";import{l as g}from"./lmnFetch-DeRrp9BG.js";import{n as x}from"./notify-CXlPex_L.js";import{h as X}from"./handleTokenExpiration-BsSYarxJ.js";import{_ as me}from"./index-Ak6w9NJ_.js";import{_ as Y}from"./index-CRgHs0Pg.js";import{_ as q}from"./index-Bt0YRkAh.js";import{c as y,s as D,i as Z,l as M,a as he}from"./loadDirectory-DyHUXo09.js";const ye={class:"flex flex-col h-full max-h-full overflow-hidden relative"},xe={class:"relative w-full border-b border-zinc-200 dark:border-zinc-700 flex flex-row pr-4 items-center gap-1"},ge=["placeholder"],ke={class:"flex flex-row items-center px-4 py-2 pl-2 border-b border-zinc-200 dark:border-zinc-700 overflow-x-auto shrink-0"},be={class:"text-xs"},ze=a("span",{class:"text-zinc-400 text-sm"},"/",-1),Ce={key:0,class:"flex flex-col items-center justify-center p-8"},$e={class:"text-sm text-zinc-500"},Se={key:1,class:"overflow-y-auto p-2"},Fe=["onClick"],De={class:"flex flex-row gap-3 items-center"},Me={class:"aspect-square h-6 flex flex-col justify-center items-center"},Ne={class:"truncate grow text-sm"},Re={class:"absolute flex flex-row items-center justify-end right-3 group-hover:bg-gradient-to-l from-zinc-100 dark:from-zinc-800 to-transparent w-3/4 pointer-events-none"},Te={class:"flex flex-row items-center w-full"},je={class:"flex flex-col grow gap-1 max-w-full overflow-hidden"},Be={class:"flex flex-row gap-3 items-center"},Ve={class:"truncate grow text-sm"},Ee={class:"text-xs text-zinc-500 whitespace-nowrap"},Ae={class:"absolute flex flex-row items-center justify-end right-3 group-hover:bg-gradient-to-l from-zinc-100 dark:from-zinc-800 to-transparent w-3/4"},Ie={key:2,class:"flex flex-col items-center justify-center p-8 text-zinc-500"},Le={class:"text-sm"},Oe={class:"flex flex-col gap-3 p-6 w-[360px]"},qe={class:"text-lg font-medium text-zinc-900 dark:text-zinc-100 mb-6"},Pe={class:"mb-4 grid grid-cols-3 ml-3"},Ue={class:"flex flex-col justify-center"},We={class:"block text-sm"},Ge={class:"flex justify-end gap-2"},He={class:"flex flex-col gap-3 p-6 w-[360px]"},Ke={class:"text-lg font-medium text-zinc-900 dark:text-zinc-100 mb-6"},Je={class:"mb-4 grid grid-cols-3 ml-3"},Qe={class:"flex flex-col justify-center"},Xe={class:"block text-sm"},Ye={class:"flex justify-end gap-2"},Ze={key:0,class:"mt-2 text-red-500 text-sm"},et={__name:"directory",setup(ne){const u=ee(),b=te(),k=se(),R=d(null),z=d(!1),$=d(!1);d(!1);const S=d(!1);d(null),d("");const p=d(""),_=d(""),h=d(""),C=d(null),N=d([]),P=K(()=>y.value?y.value.split("/"):[]),U=K(()=>D.value?Z.value.filter(e=>e.name.toLowerCase().includes(D.value.toLowerCase())):Z.value),T=e=>{M(e)},oe=async()=>{if(!p.value||!p.value.includes(".")){x({title:(0,window.wp.i18n.__)("Error","snipvault"),message:(0,window.wp.i18n.__)("File name is required","snipvault"),type:"error"});return}const e=y.value?`${y.value}/${p.value}`:p.value,t=await g({endpoint:"snipvault/v1/filesystem/exists",params:{path:e}});if(!t)return;if(t.data.exists){x({title:(0,window.wp.i18n.__)("Failed to create new file","snipvault"),message:(0,window.wp.i18n.__)("File already exists.","snipvault"),type:"error"});return}u.updateState("loading",!0);const l={endpoint:"snipvault/v1/filesystem/write/",type:"POST",params:{path:e,filename:p.value},data:{content:""}},o=await g(l);u.updateState("loading",!1),o&&(k.push(`/file-browser/${e}`),z.value.close(),p.value="",_.value="",M(y.value,!0),x({title:(0,window.wp.i18n.__)("Success","snipvault"),message:(0,window.wp.i18n.__)("File created successfully","snipvault"),type:"success"}))},ie=async()=>{if(!h.value){x({title:(0,window.wp.i18n.__)("Error","snipvault"),message:(0,window.wp.i18n.__)("Directory name is required","snipvault"),type:"error"});return}const e=y.value?`${y.value}/${h.value}`:h.value,t=await g({endpoint:"snipvault/v1/filesystem/exists",params:{path:e}});if(!t)return;if(t.data.exists){x({title:(0,window.wp.i18n.__)("Failed to create new directory","snipvault"),message:(0,window.wp.i18n.__)("Directory already exists.","snipvault"),type:"error"});return}u.updateState("loading",!0);const o=await g({endpoint:"snipvault/v1/filesystem/create-directory/",type:"POST",params:{path:e}});u.updateState("loading",!1),o&&(k.push(`/file-browser/${e}`),$.value.close(),h.value="",T(e),x({title:(0,window.wp.i18n.__)("Success","snipvault"),message:(0,window.wp.i18n.__)("Directory created successfully","snipvault"),type:"success"}))},le=async e=>{const t={endpoint:"snipvault/v1/filesystem/read/",type:"GET",params:{path:e.path}},l=await g(t);if(!l)return;u.updateState("loading",!1);const o=W(e.path),s=W(e.name);u.updateState("loading",!0);const w={endpoint:"snipvault/v1/filesystem/write/",type:"POST",params:{path:o,filename:s},data:{content:l.data.content}},j=await g(w);u.updateState("loading",!1),j&&(k.push(`/file-browser/${o}`),z.value.close(),p.value="",_.value="",M(y.value,!0),x({title:(0,window.wp.i18n.__)("File duplicated","snipvault"),type:"success"}))};function W(e,t=!1){if(!e||typeof e!="string")return e;const l=new Date,o=t?l.toISOString().replace(/:/g,"-").replace(/\..+/,""):Math.floor(l.getTime()/1e3),s=e.lastIndexOf(".");if(s===-1)return`${e}.${o}`;const w=e.substring(0,s),j=e.substring(s);return`${w}-${o}${j}`}const I=async e=>{if(!await R.value.show({title:(0,window.wp.i18n.__)("Are you sure?","snipvault"),message:(0,window.wp.i18n.__)("Are you sure you want to delete this file? ","snipvault"),okButton:(0,window.wp.i18n.__)("Delete","snipvault")}))return;u.updateState("loading",!0);const l={endpoint:"snipvault/v1/filesystem/delete/",type:"DELETE",params:{path:e.path}},o=await g(l);u.updateState("loading",!1),o&&(x({title:(0,window.wp.i18n.__)("Item deleted","snipvault"),message:(0,window.wp.i18n.__)("Item deleted successfully","snipvault"),type:"success"}),S.value=!1,C.value=null,M(y.value,!0),e.path==b.params.filepath&&await k.push("/file-browser"))},re=e=>{const t=N.value.indexOf(e);t===-1?N.value.push(e):N.value.splice(t,1)},G=e=>N.value.includes(e),ce=e=>{if(e===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+l[o]},H=e=>{const t=e.name.split("."),l=t[t.length-1];return e.name.startsWith(l)?"file":t[t.length-1].toLowerCase()},ue=e=>{const t=H(e);return t=="php"?"text-indigo-400":t=="js"?"text-amber-400":t=="css"?"text-sky-400":t=="scss"?"text-pink-400":t=="html"?"text-orange-400":t=="txt"?"text-zinc-400":t=="json"?"text-yellow-400":"text-slate-400"};return pe(()=>{M()}),de(()=>D.value,()=>M()),(e,t)=>{var o;const l=ae("RouterLink");return c(),v("div",ye,[a("div",xe,[n(f,{icon:"search",class:"absolute left-5 top-1/2 -translate-y-1/2 text-zinc-500"}),fe(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>_e(D)?D.value=s:null),placeholder:e.__("Search files...","snipvault"),class:"px-6 py-4 pl-12 w-full bg-white dark:bg-zinc-900 focus:outline-0 grow"},null,8,ge),[[ve,L(D)]]),n(m,{type:"transparent",onClick:z.value.show},{default:r(()=>[n(f,{icon:"post_add",class:"text-lg"})]),_:1},8,["onClick"]),n(m,{type:"transparent",onClick:$.value.show},{default:r(()=>[n(f,{icon:"create_new_folder",class:"text-lg"})]),_:1},8,["onClick"])]),a("div",ke,[n(m,{onClick:t[1]||(t[1]=s=>T("")),type:"transparent",class:"hover:bg-zinc-100 dark:hover:bg-zinc-700 px-2 py-1 rounded"},{default:r(()=>[n(f,{icon:"home"}),F(),a("span",be,i(e.__("Root","snipvault")),1)]),_:1}),(c(!0),v(E,null,J(P.value,(s,w)=>(c(),v(E,{key:w},[ze,n(m,{onClick:j=>T(P.value.slice(0,w+1).join("/")),type:"transparent",class:"text-xs hover:bg-zinc-100 dark:hover:bg-zinc-700 px-2 py-1 rounded"},{default:r(()=>[F(i(s),1)]),_:2},1032,["onClick"])],64))),128))]),L(he)?(c(),v("div",Ce,[n(f,{icon:"refresh",class:"text-3xl animate-spin text-zinc-400 mb-2"}),a("span",$e,i(e.__("Loading...","snipvault")),1)])):U.value.length>0?(c(),v("div",Se,[(c(!0),v(E,null,J(U.value,s=>(c(),v("div",{key:s.path,class:"mb-1"},[s.type==="directory"?(c(),v("div",{key:0,class:B(["flex flex-row px-2 py-2 pr-4 cursor-pointer transition-all group relative rounded-lg","hover:text-zinc-900 hover:dark:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800"]),onClick:w=>T(s.path)},[a("div",De,[a("div",Me,[n(f,{icon:"folder",class:"text-xl text-zinc-200 dark:text-zinc-700"})]),a("div",Ne,i(s.name),1),a("div",Re,[n(m,{onClick:V(w=>I(s),["stop","prevent"]),type:"transparent",class:"opacity-0 group-hover:opacity-100 transition-opacity text-lg pointer-events-auto"},{default:r(()=>[n(f,{icon:"delete"})]),_:2},1032,["onClick"])])])],8,Fe)):(c(),A(l,{key:1,to:`/file-browser/${s.path}`,class:B(["flex flex-row px-2 py-2 pr-4 cursor-pointer transition-all group relative rounded-lg",s.path==L(b).params.filepath||G(s.path)?"text-zinc-900 dark:text-zinc-100 bg-zinc-100 dark:bg-zinc-800":"hover:text-zinc-900 hover:dark:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800"])},{default:r(()=>[a("div",Te,[a("div",je,[a("div",Be,[a("div",{class:B(["aspect-square h-6 rounded-md flex flex-col justify-center items-center bg-zinc-100 dark:bg-zinc-800",ue(s)])},[n(f,{icon:H(s),class:"text-xl"},null,8,["icon"])],2),a("div",Ve,i(s.name),1),a("div",Ee,i(ce(s.size)),1)])]),a("div",Ae,[n(m,{onClick:V(w=>le(s),["stop","prevent"]),type:"transparent",class:"opacity-0 group-hover:opacity-100 transition-opacity text-lg"},{default:r(()=>[n(f,{icon:"duplicate"})]),_:2},1032,["onClick"]),n(m,{onClick:V(w=>I(s),["stop","prevent"]),type:"transparent",class:"opacity-0 group-hover:opacity-100 transition-opacity text-lg"},{default:r(()=>[n(f,{icon:"delete"})]),_:2},1032,["onClick"]),a("div",{class:B(["shrink-0 group-hover:opacity-100 transition-opacity flex flex-col justify-center ml-2",G(s.path)?"":"opacity-0"])},[n(me,{onClick:V(w=>re(s.path),["stop","prevent"]),checked:N.value.includes(s.path)},null,8,["onClick","checked"])],2)])])]),_:2},1032,["to","class"]))]))),128))])):(c(),v("div",Ie,[n(f,{icon:"folder_open",class:"text-4xl mb-2"}),a("div",Le,i(e.__("This directory is empty","snipvault")),1)])),n(Q,{ref_key:"showNewFileModal",ref:z},{default:r(()=>[a("div",Oe,[a("div",qe,i(e.__("Create New File","snipvault")),1),a("div",Pe,[a("div",Ue,[a("label",We,i(e.__("File Name","snipvault")),1)]),n(Y,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),placeholder:e.__("filename.txt","snipvault"),class:"col-span-2",autofocus:""},null,8,["modelValue","placeholder"])]),a("div",Ge,[n(m,{onClick:t[3]||(t[3]=s=>z.value.close()),type:"default"},{default:r(()=>[F(i(e.__("Cancel","snipvault")),1)]),_:1}),n(m,{onClick:oe,type:"primary"},{default:r(()=>[F(i(e.__("Create","snipvault")),1)]),_:1})])])]),_:1},512),n(Q,{ref_key:"showNewDirModal",ref:$},{default:r(()=>[a("div",He,[a("div",Ke,i(e.__("Create New Directory","snipvault")),1),a("div",Je,[a("div",Qe,[a("label",Xe,i(e.__("Directory Name","snipvault")),1)]),n(Y,{modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=s=>h.value=s),placeholder:e.__("custom_dir","snipvault"),class:"col-span-2",autofocus:""},null,8,["modelValue","placeholder"])]),a("div",Ye,[n(m,{onClick:t[5]||(t[5]=s=>$.value.close()),type:"default"},{default:r(()=>[F(i(e.__("Cancel","snipvault")),1)]),_:1}),n(m,{onClick:ie,type:"primary"},{default:r(()=>[F(i(e.__("Create","snipvault")),1)]),_:1})])])]),_:1},512),n(q,{ref_key:"showDeleteModal",ref:S,onConfirm:I,onCancel:t[6]||(t[6]=s=>S.value=!1),title:e.__("Confirm Delete","snipvault"),message:e.__("Are you sure you want to delete","snipvault")+" "+((o=C.value)==null?void 0:o.name)+"?","confirm-text":e.__("Delete","snipvault"),"cancel-text":e.__("Cancel","snipvault")},{default:r(()=>{var s;return[((s=C.value)==null?void 0:s.type)==="directory"?(c(),v("div",Ze,i(e.__("Warning: This will delete all files and subdirectories inside this directory.","snipvault")),1)):O("",!0)]}),_:1},8,["title","message","confirm-text","cancel-text"]),n(q,{ref_key:"confirm",ref:R},null,512)])}}},tt={class:"w-[300px] border-r border-zinc-200 dark:border-zinc-700 h-full max-h-full shrink-0"},st={class:"grow overflow-hidden"},at={key:1,class:"w-full h-full flex flex-col items-center justify-center p-16"},dt={__name:"index",setup(ne){const u=ee();te();const b=d(!1),k=d(null),R=se(),z=async()=>{u.updateState("loading",!0);const _=await g({endpoint:"snipvault/v1/filesystem/status"});if(u.updateState("loading",!1),!_)return;if(_.data.active){b.value=!0,X(_.data.expires,S,C=>{});return}if(!await k.value.show({title:(0,window.wp.i18n.__)("Enable File Browser?","snipvault"),message:(0,window.wp.i18n.__)("For security reasons, file browsing and editing requires temporary activation. Once activated, it will remain available for one hour and then automatically deactivate.","snipvault"),okButton:(0,window.wp.i18n.__)("Activate for 1 Hour","snipvault")})){R.push("/");return}$()},$=async()=>{u.updateState("loading",!0);const _=await g({endpoint:"snipvault/v1/filesystem/enable",type:"POST"});if(u.updateState("loading",!1),!!_&&_.data.success){b.value=!0,x({title:(0,window.wp.i18n.__)("File browsing enabled","snipvault"),type:"success"}),X(_.data.expires,S,h=>{});return}},S=async()=>{await k.value.show({title:(0,window.wp.i18n.__)("File browser access has expired","snipvault"),message:(0,window.wp.i18n.__)("For security reasons, access to the file browser has now expired. Would you like to extend access for one hour?","snipvault"),okButton:(0,window.wp.i18n.__)("Activate for 1 Hour","snipvault")})&&activateCLI()};return z(),(p,_)=>{const h=ae("RouterView");return c(),v(E,null,[a("div",tt,[b.value?(c(),A(et,{key:0})):O("",!0)]),a("div",st,[b.value?(c(),A(h,{key:0},{default:r(({Component:C})=>[C?(c(),A(we(C),{key:0})):(c(),v("div",at,[n(f,{icon:"code",style:{"font-size":"88px"}}),a("div",null,i(p.__("No file selected","snipvault")),1)]))]),_:1})):O("",!0)]),n(q,{ref_key:"confirm",ref:k},null,512)],64)}}};export{dt as default};
//# sourceMappingURL=index-_38YN2Uq.js.map
