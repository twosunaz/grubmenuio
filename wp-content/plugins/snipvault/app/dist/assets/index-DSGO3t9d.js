import{u as Z,e as l,f as ee,O as te,g as o,j as t,i as p,A as se,B as ne,t as i,F as b,v as w,w as T,k as C,s as q,c as ae,D as O,a as oe,o as r,_ as k,n as ie,l as L,y as re}from"../app.build.DVcfFWU_.js";import{l as E}from"./lmnFetch-DeRrp9BG.js";import{n as m}from"./notify-CXlPex_L.js";import{h as F}from"./handleTokenExpiration-BsSYarxJ.js";import{_ as le}from"./index-CqlI0lnC.js";import{_ as ue}from"./index-Bt0YRkAh.js";const ce={class:"flex h-full w-full overflow-hidden"},de={class:"w-[300px] border-r border-zinc-200 dark:border-zinc-700 h-full max-h-full shrink-0 flex flex-col"},pe=t("div",{class:"px-4 py-3 border-b border-zinc-200 dark:border-zinc-700 flex items-center justify-between"},[t("h2",{class:"text-lg font-medium"},"SQL Editor")],-1),ve={class:"relative w-full border-b border-zinc-200 dark:border-zinc-700 flex flex-row pr-4 items-center gap-1"},_e=["placeholder"],fe={class:"overflow-y-auto flex-grow p-2"},be={class:"py-2 px-4"},we={class:"text-sm font-medium text-zinc-400 mb-2"},me=["onClick"],ye={class:"py-2 px-4"},ge={class:"text-sm font-medium text-zinc-400 mb-2"},he=["onClick"],xe={class:"py-2 px-4"},ke={class:"flex items-center text-sm font-medium text-zinc-400 mb-2"},Ee=["onClick"],Se=["innerHTML","onBlur"],Re={class:"absolute right-0 h-full flex flex-col justify-center opacity-0 transition-opacity group-hover:opacity-100"},ze={class:"grow flex flex-col overflow-hidden w-full h-full"},Te={class:"h-[50%] border-b border-zinc-200 dark:border-zinc-700 flex flex-col"},Ce={class:"px-4 py-2 border-t border-zinc-200 dark:border-zinc-700 flex justify-between items-center"},Le={class:"flex items-center space-x-2"},Oe=["disabled","loading"],Qe={class:"h-[50%] overflow-auto flex flex-col"},Ie={key:0,class:"flex-grow overflow-auto p-4"},De={key:0},Me={class:"col-span-3 rounded-lg bg-rose-500/10 border border-rose-600/60 p-4 text-sm mt-6"},Be={class:"mb-3"},qe={class:"text-zinc-500 dark:text-zinc-400 text-center py-10"},Fe={key:1,class:"text-red-500 p-4 bg-red-500 bg-opacity-10 rounded"},Ue=t("div",{class:"font-bold"},"Error:",-1),$e={key:2,class:"overflow-x-auto"},Ae={class:"w-full text-sm border-collapse"},Ne={class:"bg-zinc-100 dark:bg-zinc-800"},Pe={class:"mt-2 text-sm text-zinc-400"},Ve={key:3,class:"p-4 bg-zinc-100 dark:bg-zinc-800 rounded"},He={class:"text-green-600 dark:text-green-400 mb-2 flex flex-row items-center gap-3"},Ye={class:"text-zinc-500 dark:text-zinc-400"},Ge={key:1,class:"flex-grow overflow-auto p-4"},je=t("div",{class:"text-zinc-400 text-center py-10"},[O(" Chart visualization will be available here. "),t("div",{class:"mt-2 text-sm"},"(Only works with numerical data from SELECT queries)")],-1),We=[je],nt={__name:"index",setup(Je){const v=Z();oe();const Q=l(!1),y=l(null),U=ae(),c=l("SELECT * FROM wp_posts LIMIT 10;"),g=l(!1),d=l(null),S=l("results"),R=l([]),h=l("");l([]),l([]);const u=l([{id:1,name:"Untitled query",content:"SELECT * FROM wp_posts LIMIT 10;"}]),_=l(null),x=l(!1),$=l([{id:"post_count",name:"Post Count by Status",content:"SELECT post_status, COUNT(*) as count FROM wp_posts GROUP BY post_status ORDER BY count DESC;"},{id:"recent_users",name:"Recent User Registrations",content:"SELECT ID, user_login, user_email, user_registered FROM wp_users ORDER BY user_registered DESC LIMIT 20;"},{id:"comment_stats",name:"Comment Statistics",content:"SELECT comment_approved, COUNT(*) as count FROM wp_comments GROUP BY comment_approved;"}]),A=l([{id:"user_info",name:"User Information",content:"SELECT ID, user_login, user_email, user_registered FROM wp_users LIMIT 10;"},{id:"post_meta",name:"Popular Post Meta",content:"SELECT meta_key, COUNT(*) as count FROM wp_postmeta GROUP BY meta_key ORDER BY count DESC LIMIT 20;"}]),N=async()=>{v.updateState("loading",!0);const n=await E({endpoint:"snipvault/v1/sql/status"});if(v.updateState("loading",!1),!n)return;if(n.data.active){Q.value=!0,F(n.data.expires,D,a=>{}),M();return}if(!await y.value.show({title:(0,window.wp.i18n.__)("Enable SQL Editor?","snipvault"),message:(0,window.wp.i18n.__)("For security reasons, SQL editor access requires temporary activation. Once activated, it will remain available for one hour and then automatically deactivate.","snipvault"),okButton:(0,window.wp.i18n.__)("Activate for 1 Hour","snipvault")})){U.push("/");return}I()},I=async()=>{v.updateState("loading",!0);const n=await E({endpoint:"snipvault/v1/sql/enable",type:"POST"});if(v.updateState("loading",!1),!!n&&n.data.success){Q.value=!0,m({title:(0,window.wp.i18n.__)("SQL Editor enabled","snipvault"),type:"success"}),F(n.data.expires,D,s=>{}),M();return}},D=async()=>{await y.value.show({title:(0,window.wp.i18n.__)("SQL Editor access has expired","snipvault"),message:(0,window.wp.i18n.__)("For security reasons, access to the SQL Editor has now expired. Would you like to extend access for one hour?","snipvault"),okButton:(0,window.wp.i18n.__)("Activate for 1 Hour","snipvault")})&&I()},M=async()=>{v.updateState("loading",!0);const n=await E({endpoint:"snipvault/v1/sql/tables"});v.updateState("loading",!1),!(!n||!n.data.success)&&(R.value=n.data.tables)},P=async()=>{if(!c.value||g.value)return;const e=V(c.value);let n=!1;if(e)if(await y.value.show({title:(0,window.wp.i18n.__)("Hold up!","snipvault"),message:(0,window.wp.i18n.__)("This query contains operations that could modify or delete database content. Please ensure you:<br><br>• Have a recent database backup<br>• Understand the exact changes this query will make<br>• Are running this in the correct environment<br><br>Do you want to proceed with execution?","snipvault"),okButton:(0,window.wp.i18n.__)("Run","snipvault")}))n=!0;else return;g.value=!0,v.updateState("loading",!0);const s={endpoint:"snipvault/v1/sql/query",type:"POST",data:{query:c.value,force_confirm:n,skip_security_check:n}},a=await E(s);g.value=!1,v.updateState("loading",!1),a||(d.value={error:(0,window.wp.i18n.__)("Query execution failed","snipvault")}),a&&a.data&&(d.value=a.data,S.value="results",m({title:(0,window.wp.i18n.__)("Query executed successfully","snipvault"),type:"success"}))},V=e=>{const n=e.trim().replace(/\s+/g," "),s=n.split(" ")[0].toUpperCase(),f=["SELECT","SHOW","DESCRIBE","DESC","EXPLAIN"].includes(s),K=[/\bDROP\b/i,/\bALTER\b/i,/\bCREATE\b/i,/\bTRUNCATE\b/i,/\bGRANT\b/i,/\bREVOKE\b/i,/\bDELETE\b\s+(?!FROM)/i,/;.+/s];if(/;.+/s.test(n)||s==="DELETE"&&!/\bDELETE\s+FROM\b/i.test(n))return!0;for(const X of K)if(X.test(n))return!0;return!f},B=e=>{c.value=e.content},H=e=>{c.value=e.content,_.value=e.id,x.value=!0},z=()=>{localStorage.setItem("snipvault_sql_queries",JSON.stringify(u.value))},Y=()=>{const e=localStorage.getItem("snipvault_sql_queries");e&&(u.value=JSON.parse(e))},G=()=>{if(_.value){const e=u.value.findIndex(n=>n.id===_.value);e>=0&&(u.value[e].content=c.value,m({title:(0,window.wp.i18n.__)("Query updated","snipvault"),type:"success"}))}else{const e=Math.max(0,...u.value.map(n=>n.id))+1;u.value.push({id:e,name:"Untitled query "+e,content:c.value}),_.value=e,m({title:(0,window.wp.i18n.__)("Query saved","snipvault"),type:"success"})}x.value=!0,z()},j=async e=>{if(!await y.value.show({title:(0,window.wp.i18n.__)("Delete Query?","snipvault"),message:(0,window.wp.i18n.__)("Are you sure you want to delete this query? This action cannot be undone.","snipvault"),okButton:(0,window.wp.i18n.__)("Delete","snipvault")}))return;const s=u.value.findIndex(a=>a.id===e);s>=0&&(u.value.splice(s,1),_.value===e&&(_.value=null,x.value=!1),z(),m({title:(0,window.wp.i18n.__)("Query deleted","snipvault"),type:"success"}))},W=()=>{const e=c.value.replace(/(\bSELECT\b)/gi,`
$1`).replace(/(\bFROM\b)/gi,`
$1`).replace(/(\bWHERE\b)/gi,`
$1`).replace(/(\bGROUP BY\b)/gi,`
$1`).replace(/(\bORDER BY\b)/gi,`
$1`).replace(/(\bLIMIT\b)/gi,`
$1`).replace(/(\bJOIN\b)/gi,`
$1`).replace(/(\bAND\b)/gi,`
  $1`).replace(/(\bOR\b)/gi,`
  $1`);c.value=e},J=async(e,n)=>{const s=e.target.innerHTML.trim(),a=u.value.findIndex(f=>f.id===n.id);s&&s!=u.value[a].name&&a>=0&&(u.value[a].name=s,z(),m({title:(0,window.wp.i18n.__)("Query renamed","snipvault"),type:"success"}))};return ee(()=>h.value?R.value.filter(e=>e.name.toLowerCase().includes(h.value.toLowerCase())):R.value),te(()=>{N(),Y()}),(e,n)=>(r(),o("div",ce,[t("div",de,[pe,t("div",ve,[p(k,{icon:"search",class:"absolute left-5 top-1/2 -translate-y-1/2 text-zinc-500"}),se(t("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=s=>h.value=s),placeholder:e.__("Search queries...","snipvault"),class:"px-6 py-4 pl-12 w-full bg-white dark:bg-zinc-900 focus:outline-0 grow"},null,8,_e),[[ne,h.value]])]),t("div",fe,[t("div",be,[t("div",we,i(e.__("Templates","snipvault")),1),(r(!0),o(b,null,w($.value,s=>(r(),o("div",{key:s.id,class:"text-sm py-1 px-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded cursor-pointer",onClick:a=>B(s)},i(s.name),9,me))),128))]),t("div",ye,[t("div",ge,i(e.__("Quickstarts","snipvault")),1),(r(!0),o(b,null,w(A.value,s=>(r(),o("div",{key:s.id,class:"text-sm py-1 px-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded cursor-pointer",onClick:a=>B(s)},i(s.name),9,he))),128))]),t("div",xe,[t("div",ke,[t("span",null,i(e.__("Saved","snipvault"))+" ("+i(u.value.length)+")",1)]),(r(!0),o(b,null,w(u.value,s=>(r(),o("div",{key:s.id,class:ie(["text-sm py-1 px-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded cursor-pointer flex items-center relative group",_.value===s.id?"bg-zinc-200 dark:bg-zinc-800":""]),onClick:a=>H(s)},[t("div",{class:"truncate text-sm",contenteditable:!0,innerHTML:s.name,onBlur:a=>J(a,s),onKeydown:n[1]||(n[1]=re(L(a=>a.target.blur(),["prevent"]),["enter"])),onClick:n[2]||(n[2]=L(()=>{},["stop"]))},null,40,Se),t("div",Re,[p(C,{onClick:L(a=>j(s.id),["stop","prevent"]),type:"transparent"},{default:T(()=>[p(k,{icon:"delete"})]),_:2},1032,["onClick"])])],10,Ee))),128))])])]),t("div",ze,[t("div",Te,[p(le,{modelValue:c.value,"onUpdate:modelValue":n[3]||(n[3]=s=>c.value=s),language:"sql",class:"flex-grow",theme:"vs-dark"},null,8,["modelValue"]),t("div",Ce,[t("div",Le,[p(C,{onClick:W,type:"default"},{default:T(()=>[O(i(e.__("Format","snipvault")),1)]),_:1}),p(C,{onClick:G,type:"default"},{default:T(()=>[O(i(x.value?e.__("Update","snipvault"):e.__("Save","snipvault")),1)]),_:1})]),t("button",{onClick:P,disabled:g.value,loading:g.value,class:"transition-all rounded-lg w-auto cursor-pointer relative group whitespace-nowrap bg-green-700 px-3 py-1 text-zinc-200 hover:text-zinc-50 hover:bg-green-900 transition-all border border-green-600 disabled:text-zinc-600 outline outline-1 outline-offset-[-2px] outline-zinc-100/10 dark:outline-0 dark:border-zinc-700 dark:hover:bg-green-800 flex flex-row items-center gap-2"},[p(k,{icon:"play_arrow"}),t("span",null,i(e.__("Run","snipvault")),1)],8,Oe)])]),t("div",Qe,[S.value==="results"?(r(),o("div",Ie,[d.value?d.value.error?(r(),o("div",Fe,[Ue,t("div",null,i(d.value.error),1)])):d.value.type==="select"?(r(),o("div",$e,[t("table",Ae,[t("thead",null,[t("tr",Ne,[(r(!0),o(b,null,w(d.value.columns,s=>(r(),o("th",{key:s,class:"px-4 py-2 text-left border border-zinc-200 dark:border-zinc-700"},i(s),1))),128))])]),t("tbody",null,[(r(!0),o(b,null,w(d.value.rows,(s,a)=>(r(),o("tr",{key:a,class:"hover:bg-zinc-100 dark:hover:bg-zinc-800"},[(r(!0),o(b,null,w(d.value.columns,f=>(r(),o("td",{key:f,class:"px-4 py-2 border border-zinc-200 dark:border-zinc-700"},i(s[f]),1))),128))]))),128))])]),t("div",Pe,i(d.value.rowCount)+" "+i(e.__("rows returned","snipvault")),1)])):(r(),o("div",Ve,[t("div",He,[p(k,{icon:"tick",class:"text-xl"}),t("span",null,i(e.__("Query executed successfully","snipvault")),1)]),t("div",Ye,i(d.value.message),1)])):(r(),o("div",De,[t("div",Me,[t("p",Be,i(e.__("Direct SQL execution is powerful but potentially dangerous. Always backup your database before making changes.","snipvault")),1),t("p",null,i(e.__("If unsure about SQL or its effects, consult documentation or a database expert first.","snipvault")),1)]),t("div",qe,i(e.__("Click Run to execute your query.","snipvault")),1)]))])):q("",!0),S.value==="chart"?(r(),o("div",Ge,We)):q("",!0)])]),p(ue,{ref_key:"confirm",ref:y},null,512)]))}};export{nt as default};
//# sourceMappingURL=index-DSGO3t9d.js.map
